"use strict";var switchTab=Utils.switchTab;import{Cookies,token,Utils}from"./common.js";var doScrolling=Utils.doScrolling;var delay=Utils.delay;await(async()=>{const e=document.querySelector("tio-header");e.tabs[0].addEventListener("click",(()=>{doScrolling("body",1e3)}));e.tabs[1].addEventListener("click",(()=>switchTab(1)));e.tabs[2].addEventListener("click",(()=>switchTab(2)));document.getElementById("issues_btn").addEventListener("click",(()=>{open("https://github.com/Toolbox-io/Toolbox-io/issues","_self")}));let t=true;let s=null;let o=null;let l;async function i(){if(t){const e=document.getElementById("video_dialog");e.classList.add("open");const n=document.getElementById("demo");const a=n.getBoundingClientRect();let c=a.x;const d=a.y-10;if(document.documentElement.offsetWidth>500)c-=10;n.style.position="fixed";n.style.left=`${c}px`;n.style.top=`${d}px`;s=c;o=d;n.style.transitionProperty="left, top, transform";n.style.transitionDuration="0.5s";n.style.transitionTimingFunction="ease-out";n.style.zIndex="1003";l=document.createElement("video");l.style.width=a.width+"px";l.style.height=a.height+"px";l.style.margin="10px";l.style.marginBottom="0px";l.style.flexShrink="0";n.insertAdjacentElement("beforebegin",l);await delay(1);n.style.left=`calc(50% - ${a.width/2}px)`;n.style.top=`calc(50% - ${a.height/2}px)`;n.style.transform=document.documentElement.offsetWidth<=375?"scale(1.4)":"scale(1.5)";t=false;n.removeEventListener("click",i);await delay(500);n.controls=true}}async function n(){const e=document.getElementById("video_dialog");e.style.opacity="0";const n=document.getElementById("demo");n.style.left=`${s}px`;n.style.top=`${o}px`;n.style.transform="scale(1)";await delay(500);e.classList.remove("open");e.style.opacity="";t=true;n.controls=false;n.parentElement.removeChild(l);n.style.position="";n.style.zIndex="";n.style.left="";n.style.top="";n.style.transform="";s=null;o=null;n.addEventListener("click",i)}document.getElementById("demo").addEventListener("click",i);document.getElementById("video_dialog").addEventListener("click",n);const a=document.getElementById("features");const c=document.getElementById("card_dialog");Array.from(a.children).forEach((e=>{const t=e;if(!t.classList.contains("replacement")&&t.classList.length>0){const e=document.createElement("div");const s=t.querySelector(".feature-description");const o=t.querySelector(".feature-long-description");const l=t.querySelector(".feature-close");t.addEventListener("click",(async()=>{if(!t.classList.contains("expanded")){const i=t.getBoundingClientRect();t.insertAdjacentElement("afterend",e);e.innerHTML=t.innerHTML;e.classList.add("placeholder","feature");e.id=`${t.id}_placeholder`;t.classList.add("noHover");c.classList.add("open");s.style.opacity="0";s.style.display="none";o.style.display="block";o.style.opacity="1";l.style.display="block";l.style.opacity="1";t.classList.add("expanded")}}));l.addEventListener("click",(async()=>{t.classList.add("closing");o.style.opacity="0";l.style.opacity="0";c.style.opacity="0";t.style.opacity="0";await delay(500);c.classList.remove("open");c.style.opacity="";o.style.display="none";l.style.display="none";s.style.display="block";s.style.opacity="1";t.style.animation="";t.style.opacity="1";t.classList.remove("noHover","expanded");Array.from(a.children).forEach((e=>{const t=e;if(t.classList.length>0){t.style.width="";t.style.height="";t.style.boxSizing=""}}));e.remove();await delay(500);t.classList.remove("closing")}))}}));try{let e=Cookies.get("release-ratelimitRemaining");let t=Cookies.get("release-ratelimitReset");if(t===null){t=(Date.now()+100).toString()}if(e===null){e="-1"}let s=Number(e)!==0;if(!s){s=Date.now()>Number(t)}if(s){const e={Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28",Authorization:`Bearer ${token}`};const t=Cookies.get("release-etag");if(t!==null){e["if-none-match"]=t}const s=await fetch("https://api.github.com/repos/Toolbox-io/Toolbox-io/releases/latest",{method:"GET",headers:e});if(s.ok||s.status===304){let e;if(s.status===304){console.log("304 Not Modified");e=Cookies.get("release-download_url")}else{const t=await s.json();e=t.assets[0].browser_download_url}document.getElementById("download_url").href=e;const t=s.headers.get("etag");console.log(t);if(t!==null){Cookies.set("release-etag",t)}Cookies.set("release-download_url",e)}const o=s.headers.get("X-Ratelimit-Remaining");const l=s.headers.get("X-Ratelimit-Reset");Cookies.set("release-ratelimitRemaining",o);Cookies.set("release-ratelimitReset",l);console.log(`Rate limit remaining: ${o}`);console.log(`Rate limit reset: ${l}`)}else{console.warn(`Rate limit exceeded, it will be reset at ${Cookies.get("release-ratelimitReset")}`)}}catch(e){console.log(e)}})();