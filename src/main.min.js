"use strict";var switchTab=Utils.switchTab;import{Cookies,token,Utils}from"./common.js";var doScrolling=Utils.doScrolling;var delay=Utils.delay;await(async()=>{const e=document.querySelector("tio-header");e.tabs[0].addEventListener("click",(()=>{doScrolling("body",1e3)}));e.tabs[1].addEventListener("click",(()=>switchTab(1)));e.tabs[2].addEventListener("click",(()=>switchTab(2)));document.getElementById("issues_btn").addEventListener("click",(()=>{open("https://github.com/Toolbox-io/Toolbox-io/issues","_self")}));let t=true;let l=null;let n=null;let o;async function s(){if(t){const e=document.getElementById("video_dialog");e.classList.add("open");const i=document.getElementById("demo");const a=i.getBoundingClientRect();let c=a.x;const d=a.y-10;if(document.documentElement.offsetWidth>500)c-=10;i.style.position="fixed";i.style.left=`${c}px`;i.style.top=`${d}px`;l=c;n=d;i.style.transitionProperty="left, top, transform";i.style.transitionDuration="0.5s";i.style.transitionTimingFunction="ease-out";i.style.zIndex="1003";o=document.createElement("video");o.style.width=a.width+"px";o.style.height=a.height+"px";o.style.margin="10px";o.style.marginBottom="0px";o.style.flexShrink="0";i.insertAdjacentElement("beforebegin",o);await delay(1);i.style.left=`calc(50% - ${a.width/2}px)`;i.style.top=`calc(50% - ${a.height/2}px)`;i.style.transform=document.documentElement.offsetWidth<=375?"scale(1.4)":"scale(1.5)";t=false;i.removeEventListener("click",s);await delay(500);i.controls=true}}async function i(){const e=document.getElementById("video_dialog");e.style.opacity="0";const i=document.getElementById("demo");i.style.left=`${l}px`;i.style.top=`${n}px`;i.style.transform="scale(1)";await delay(500);e.classList.remove("open");e.style.opacity="";t=true;i.controls=false;i.parentElement.removeChild(o);i.style.position="";i.style.zIndex="";i.style.left="";i.style.top="";i.style.transform="";l=null;n=null;i.addEventListener("click",s)}document.getElementById("demo").addEventListener("click",s);document.getElementById("video_dialog").addEventListener("click",i);const a=$("html");const c=document.getElementById("features");const d=document.getElementById("card_dialog");Array.from(c.children).forEach((e=>{const t=e;if(!t.classList.contains("replacement")&&t.classList.length>0){const e=document.createElement("div");const l=t.querySelector(".feature-description");const n=t.querySelector(".feature-long-description");const o=t.querySelector(".feature-close");t.addEventListener("click",(async()=>{if(!t.classList.contains("expanded")){const s=t.getBoundingClientRect();const i=s.x;const a=s.y-5;const r=s.width;const y=s.height;e.classList.add("replacement");if(getComputedStyle(c).gridTemplateColumns.indexOf(" ")===-1){e.style.width=`${r}px`;e.style.height=`${y}px`}else{e.style.width="";e.style.height=""}Array.from(c.children).forEach((e=>{if(e!=t&&e.classList.length>0){const t=e;const l=t.getBoundingClientRect();t.style.width=`${l.width}px`;t.style.height=`${l.height}px`;t.style.boxSizing="border-box"}}));t.style.top=`${a}px`;t.style.left=`${i}px`;t.style.width=`${r}px`;t.style.height=`${y}px`;t.insertAdjacentElement("beforebegin",e);t.style.position="fixed";t.style.boxSizing="border-box";t.style.zIndex="1001";t.style.transform="none";t.style.animation="cardExpand 0.5s ease-in-out";t.style.animationFillMode="forwards";t.classList.add("noHover");d.classList.add("open");l.style.opacity="0";await delay(500);l.style.display="none";n.style.display="block";n.style.opacity="1";o.style.display="block";o.style.opacity="1";await delay(500);t.classList.add("expanded")}}));o.addEventListener("click",(async()=>{const s=getComputedStyle(t);const i=s.top;const r=s.left;const y=s.width;const m=s.height;t.style.animation="";t.style.top=i;t.style.left=r;t.style.width=y;t.style.height=m;const h=e.getBoundingClientRect();const p=s.top;const u=s.left;t.style.top="";t.style.left="";const g=Number(s.top.replace("px",""))+(e.getBoundingClientRect().y-c.getBoundingClientRect().y)-a.scrollTop()+"px";const f=Number(s.left.replace("px",""))+(e.getBoundingClientRect().x-c.getBoundingClientRect().x)-a.scrollLeft()+"px";t.style.top=`${p}`;t.style.left=`${u}`;let x=document.head.querySelector("style#tmp");if(x==null){x=document.createElement("style")}x.innerHTML=`\n            @keyframes cardCollapse {\n                from {}\n                to {\n                    top: ${g};\n                    left: ${f};\n                    width: ${h.width}px;\n                    height: ${h.height}px;\n                }\n            }\n            `;x.id="tmp";document.head.appendChild(x);t.style.animation="cardCollapse 0.5s ease-in-out";t.style.animationFillMode="";n.style.opacity="0";o.style.opacity="0";d.style.opacity="0";await delay(500);d.classList.remove("open");d.style.opacity="";n.style.display="none";o.style.display="none";l.style.display="block";l.style.opacity="1";t.style.animation="";e.remove();t.style.top="";t.style.left="";t.style.width="";t.style.height="";t.style.position="";t.style.zIndex="";t.style.boxSizing="";t.style.transform="";t.classList.remove("noHover","expanded");Array.from(c.children).forEach((e=>{const t=e;if(t.classList.length>0){t.style.width="";t.style.height="";t.style.boxSizing=""}}))}))}}));function r(e,t){let l;let n=0;while((l=e.exec(t))!==null){if(l.index===e.lastIndex){e.lastIndex++}l.forEach(((e,t)=>{console.log(`Found match, group ${t}: ${e}`)}));n++}return n}function y(e,t){let l=/(\d+)px/gm;let n;let o=0;let s=null;while((n=l.exec(getComputedStyle(e).gridTemplateRows))!==null){o++;if(n.index===l.lastIndex){l.lastIndex++}if(o===t){n.forEach(((e,t)=>{if(t===1){s=Number(e)}}))}if(s!==null)return s}return s}function m(e){return r(/\d+px/gm,getComputedStyle(e).gridTemplateRows)}function h(e){return r(/\d+px/gm,getComputedStyle(e).gridTemplateColumns)}function p(e,t,l){const n=(t-1)*h(e)+(l-1);const o=e.children;return o[n]||null}function u(){c.querySelectorAll(".placeholder").forEach((e=>e.remove()));const e=m(c);const t=h(c);const l=[];for(let n=1;n<=e;n++){let e=null;for(let o=1;o<=t;o++){const t=p(c,n,o);if(!t&&e!=null){const e=document.createElement("div");e.style.height=`${y(c,n)}px`;e.classList.add("placeholder");l.push(e)}else{e=t}}}for(const e of l){c.appendChild(e)}}function g(){Array.from(c.children).forEach((e=>{const t=e;if(t.classList.length===0){t.style.height=""}}));const e=m(c);const t=h(c);for(let l=1;l<=e;l++){for(let e=1;e<=t;e++){const t=p(c,l,e);if(t!==null&&t.classList.length===0){t.style.height=`${y(c,l)}px`}}}}u();let f=m(c);let x=h(c);let w=innerWidth;addEventListener("resize",(async()=>{let e=m(c);let t=h(c);if(e!==f||t!==x){if(innerWidth<w&&innerWidth<=1e3||innerWidth>w&&innerWidth>1e3){await delay(500)}Array.from(c.children).forEach((e=>{if(e.classList.length===0)e.remove()}));u();f=m(c);x=h(c)}else{g()}w=innerWidth}));try{let e=Cookies.get("release-ratelimitRemaining");let t=Cookies.get("release-ratelimitReset");if(t===null){t=(Date.now()+100).toString()}if(e===null){e="-1"}let l=Number(e)!==0;if(!l){l=Date.now()>Number(t)}if(l){const e={Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28",Authorization:`Bearer ${token}`};const t=Cookies.get("release-etag");if(t!==null){e["if-none-match"]=t}const l=await fetch("https://api.github.com/repos/Toolbox-io/Toolbox-io/releases/latest",{method:"GET",headers:e});if(l.ok||l.status===304){let e;if(l.status===304){console.log("304 Not Modified");e=Cookies.get("release-download_url")}else{const t=await l.json();e=t.assets[0].browser_download_url}document.getElementById("download_url").href=e;const t=l.headers.get("etag");console.log(t);if(t!==null){Cookies.set("release-etag",t)}Cookies.set("release-download_url",e)}const n=l.headers.get("X-Ratelimit-Remaining");const o=l.headers.get("X-Ratelimit-Reset");Cookies.set("release-ratelimitRemaining",n);Cookies.set("release-ratelimitReset",o);console.log(`Rate limit remaining: ${n}`);console.log(`Rate limit reset: ${o}`)}else{console.warn(`Rate limit exceeded, it will be reset at ${Cookies.get("release-ratelimitReset")}`)}}catch(e){console.log(e)}})();