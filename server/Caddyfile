# Main domain - try HTTPS, fallback to HTTP
server.toolbox-io.ru {
    reverse_proxy localhost:8000

    # Handle different types of errors
    handle_errors {
        @errors {
            expression {err.status_code} >= 400
        }

        # Handle other errors with http.cat reverse proxy
        handle @errors {
            rewrite * /{err.status_code}
            reverse_proxy https://http.cat {
                header_up Host {upstream_hostport}
                replace_status {err.status_code}
            }
        }
    }
}