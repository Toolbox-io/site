# Simple workflow for deploying to the self-hosted server
name: Deploy to server

on:
  # Runs on pushes targeting the default branch
  push:
    branches: ["server"]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

defaults:
  run:
    working-directory: "/home/denis0001-dev/Toolbox-io"

jobs:
  deploy:
    runs-on: self-hosted
    env:
      HOME: "/home/denis0001-dev"
    steps:
      - name: Setup
        run: |
          git config --global --add safe.directory /home/denis0001-dev/Toolbox-io
      - name: Update repository
        run: git pull
      - name: Configure server
        run: echo "port=80" > server/server.properties
      - name: Start the server
        run: |
          systemctl restart server
          sleep 3
          systemctl status server
          cat /var/log/server.log
